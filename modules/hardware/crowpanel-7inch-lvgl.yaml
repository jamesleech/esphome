esphome:
  platformio_options:
    build_flags: "-DBOARD_HAS_PSRAM"
    board_build.esp-idf.memory_type: qio_opi
    board_build.flash_mode: dio

esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: y
      CONFIG_ESP32S3_DATA_CACHE_64KB: y
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: y
      CONFIG_SPIRAM_RODATA: y
  variant: esp32s3

captive_portal:

psram:
  mode: octal
  speed: 80MHz

# Define a PWM output on the ESP32 for the display backlight
output:
  - platform: ledc
    pin: 2
    frequency: 1220
    id: gpio_backlight_pwm

light:
  - platform: monochromatic
    output: gpio_backlight_pwm
    name: ${device_name} Display Backlight
    id: display_backlight
    restore_mode: ALWAYS_ON
    on_turn_on:
      - logger.log: "Display backlight turned on"
      # perhaps the light was turned on remotely, we now want to resume lvgl if it was paused
      - if:
          condition: lvgl.is_paused
          then:
            - logger.log: "LVGL resuming"
            - lvgl.resume:
            - lvgl.widget.redraw:

i2c:
  sda: GPIO19
  scl: GPIO20
  scan: true

display:
  - platform: rpi_dpi_rgb
    id: main_display
    color_order: RGB
    invert_colors: True
    update_interval: never
    auto_clear_enabled: false # takes 2.8 seconds to clear the display
    dimensions:
      width: 800
      height: 480
    de_pin: 41
    hsync_pin: 39
    vsync_pin: 40
    pclk_pin: 0
    pclk_frequency: 18MHz
    hsync_pulse_width: 48
    hsync_front_porch: 40
    hsync_back_porch: 40
    vsync_pulse_width: 31
    vsync_front_porch: 1
    vsync_back_porch: 13
    data_pins:
      red:
        - 14 #r1
        - 21 #r2
        - 47 #r3
        - 48 #r4
        - 45 #r5
      green:
        - 9 #g0
        - 46 #g1
        - 3 #g2
        - 8 #g3
        - 16 #g4
        - 1 #g5
      blue:
        - 15 #b1
        - 7 #b2
        - 6 #b3
        - 5 #b4
        - 4 #b5

touchscreen:
  platform: gt911
  id: touch0
  display: main_display
  #interrupt_pin: 19
  update_interval: 50ms
  # rotate the screen
  # transform:
  #   mirror_x: true
  #   mirror_y: true
  on_release: # handle idle wake up
    - if:
        condition: lvgl.is_paused
        then:
          - logger.log: "LVGL resuming"
          - lvgl.resume:
          - lvgl.widget.redraw:
          - light.turn_on: display_backlight
